# Optional external dependency: zlib
IF(NOT USE_BUNDLED_ZLIB)
	FIND_PACKAGE(ZLIB)
	IF(ZLIB_FOUND)
		ADD_LIBRARY(Zlib INTERFACE)
		TARGET_INCLUDE_DIRECTORIES(Zlib SYSTEM INTERFACE ${ZLIB_INCLUDE_DIRS})
		TARGET_LINK_LIBRARIES(Zlib INTERFACE ${ZLIB_LIBRARIES})

		IF(APPLE OR CMAKE_SYSTEM_NAME MATCHES "FreeBSD")
			LIST(APPEND LIBGIT2_PC_LIBS "-lz")
		ELSE()
			LIST(APPEND LIBGIT2_PC_REQUIRES "zlib")
		ENDIF()
		ADD_FEATURE_INFO(zlib ON "using system zlib")
	ELSE()
		MESSAGE(STATUS "zlib was not found; using bundled 3rd-party sources." )
	ENDIF()
ENDIF()

IF(USE_BUNDLED_ZLIB OR NOT ZLIB_FOUND)
	ADD_SUBDIRECTORY("${libgit2_SOURCE_DIR}/deps/zlib" "${libgit2_BINARY_DIR}/deps/zlib")
	ADD_FEATURE_INFO(zlib ON "using bundled zlib")
ENDIF()
